================================================================================
REFACTOR ANALYSIS - SLOT SYSTEM → CARROT ON A STICK SYSTEM
================================================================================

REQUEST SUMMARY:
----------------
1. KAMUI DEFENSIVE STYLE (COAS #1)
   - Combine: Slot 0 (Phasing) + Slot 2 (Barrier/Invulnerability)
   - Passive: Invulnerability (no cooldown)
   - Sneak: Underground phasing (spectator mode)
   - Detection: Hold COAS (any hand)

2. KAMUI OFFENSIVE STYLE (COAS #2)
   - Combine: Slot 3 (Long-range kidnap) + Slot 4 (Return) + NEW Short-range kidnap
   - Q-drop to cycle: Short-range → Long-range → Return → (repeat)
   - Short-range: 3 blocks around player, NoAI while sneaking
   - Long-range: Current raycast system
   - Return: Current return system
   - All use sneak to activate

3. KAMUI DIMENSIONAL STYLE (COAS #3)
   - Combine: Slot 1 (Kamui Travel) + Slot 5 (Genjutsu) + NEW Kamui Dimension
   - Q-drop to cycle: Kamui Travel → Kamui Dimension → Genjutsu → (repeat)
   - Kamui Travel: Current spectator system (unchanged)
   - Kamui Dimension: Teleport to void @ 0,45,0, set spawn marker, add "Kamui Overworld" to return
   - Genjutsu: Current system (unchanged)

================================================================================
FILE MODIFICATIONS NEEDED:
================================================================================

FILES TO MODIFY:
----------------
1. load.mcfunction
   - Add 3 new scoreboards for COAS mode tracking (defensive_mode, offensive_mode, dimensional_mode)
   - Add scoreboard for carrot_use detection
   - Add scoreboard for drop detection
   - Keep existing scoreboards for mechanics

2. tick.mcfunction
   - REMOVE: All slot-based function calls
   - ADD: 3 new function groups for each COAS type
   - Total rewrite of main tick logic

3. uninstall.mcfunction
   - Add new scoreboard removals

EXISTING FILES TO KEEP/MODIFY:
-------------------------------
DEFENSIVE STYLE:
- phasing/detect_activation.mcfunction → MODIFY (detect COAS instead of slot)
- phasing/sink.mcfunction → KEEP
- phasing/check_underground.mcfunction → KEEP
- phasing/check_surface.mcfunction → KEEP
- barrier/activate.mcfunction → MODIFY (remove cooldown, detect COAS)
- barrier/timer.mcfunction → DELETE (no cooldown)
- barrier/display.mcfunction → DELETE (no cooldown display)
- barrier/detect.mcfunction → DELETE (no slot detection)

OFFENSIVE STYLE:
- kamui_kidnap/detect.mcfunction → MODIFY (detect COAS + mode)
- kamui_kidnap/raycast_control.mcfunction → KEEP (for long-range)
- kamui_kidnap/raycast_step.mcfunction → KEEP
- kamui_kidnap/start_raycast.mcfunction → KEEP
- kamui_kidnap/marker_effects.mcfunction → KEEP
- kamui_kidnap/charge_kidnap.mcfunction → MODIFY (detect COAS + mode)
- kamui_kidnap/activate.mcfunction → KEEP
- kamui_kidnap/cooldown.mcfunction → KEEP
- kamui_kidnap/summon_marker.mcfunction → KEEP
- return/detect.mcfunction → MODIFY (detect COAS + mode)
- return/teleport_back.mcfunction → KEEP
- return/reset.mcfunction → KEEP
- return/cooldown.mcfunction → KEEP

DIMENSIONAL STYLE:
- kamui/charge.mcfunction → MODIFY (detect COAS + mode)
- kamui/activate.mcfunction → MODIFY (different behavior per mode)
- kamui/detect_stillness.mcfunction → KEEP
- genjutsu/detect.mcfunction → MODIFY (detect COAS + mode)
- genjutsu/effects.mcfunction → KEEP
- genjutsu/apply_damage.mcfunction → KEEP
- genjutsu/apply_damage_to_all.mcfunction → KEEP
- genjutsu/deal_damage.mcfunction → KEEP

NEW FILES TO CREATE:
--------------------
CORE SYSTEM:
1. coas/give_defensive.mcfunction (give Kamui Defensive COAS)
2. coas/give_offensive.mcfunction (give Kamui Offensive COAS)
3. coas/give_dimensional.mcfunction (give Kamui Dimensional COAS)
4. coas/detect_drop.mcfunction (detect Q-drop to cycle modes)
5. coas/mode_switch_offensive.mcfunction (cycle offensive modes)
6. coas/mode_switch_dimensional.mcfunction (cycle dimensional modes)
7. coas/detect_holding.mcfunction (detect which COAS player is holding)

DEFENSIVE STYLE:
8. defensive/main.mcfunction (main controller)
9. defensive/passive_invulnerability.mcfunction (barrier without cooldown)

OFFENSIVE STYLE:
10. offensive/main.mcfunction (main controller)
11. offensive/short_range_kidnap.mcfunction (NEW: 3-block kidnap)
12. offensive/mode_display.mcfunction (action bar showing current mode)

DIMENSIONAL STYLE:
13. dimensional/main.mcfunction (main controller)
14. dimensional/kamui_dimension_charge.mcfunction (charge to void)
15. dimensional/kamui_dimension_activate.mcfunction (teleport to void + marker)
16. dimensional/kamui_overworld_charge.mcfunction (charge to return)
17. dimensional/kamui_overworld_activate.mcfunction (return to marker)
18. dimensional/mode_display.mcfunction (action bar showing current mode)

================================================================================
TOTAL FILE COUNT:
================================================================================
FILES TO MODIFY: ~25 files
FILES TO CREATE: ~18 new files
FILES TO DELETE: ~3 files
TOTAL FILES AFFECTED: ~46 files

================================================================================
ESTIMATED TOKEN USAGE:
================================================================================
Based on complexity:

1. Core system setup (load, tick, give commands): ~2,000 tokens
2. Mode switching system (drop detection, cycling): ~3,000 tokens
3. Defensive Style (2 abilities combined): ~4,000 tokens
4. Offensive Style (3 abilities, mode cycling): ~8,000 tokens
5. Dimensional Style (3 abilities, mode cycling, markers): ~10,000 tokens
6. Testing & documentation: ~2,000 tokens

TOTAL ESTIMATED: ~29,000 tokens
CURRENT REMAINING: ~109,000 tokens

VERDICT: ✅ SUFFICIENT TOKENS AVAILABLE

================================================================================
IMPLEMENTATION STRATEGY:
================================================================================
1. Create core COAS system (give commands, detection)
2. Implement Defensive Style (simplest - 2 abilities, no modes)
3. Implement Offensive Style (medium - 3 abilities, mode cycling)
4. Implement Dimensional Style (complex - 3 abilities, mode cycling, markers)
5. Clean up old files
6. Create comprehensive testing guide

================================================================================
RISKS & CONSIDERATIONS:
================================================================================
1. Drop detection can be finicky - need to return item instantly
2. Mode persistence - need to save player's current mode
3. COAS identification - need NBT tags to distinguish 3 different sticks
4. Marker system for Kamui Overworld - need position storage
5. Testing complexity - 3 separate systems with multiple modes

================================================================================
