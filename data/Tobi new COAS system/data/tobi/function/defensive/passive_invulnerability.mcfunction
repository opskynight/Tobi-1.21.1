# ============================================
# PASSIVE INVULNERABILITY
# ============================================
# ALWAYS ACTIVE when holding Defensive COAS (no cooldown)
# Based on barrier/activate.mcfunction but simplified

# ============================================
# KILL PROJECTILES with feedback
# ============================================
execute as @a[scores={tobi_defensive=1,tobi_has_armor=1}] at @s as @e[type=arrow,distance=..5] at @s run particle minecraft:smoke ~ ~ ~ 0.2 0.2 0.2 0.05 10 force
execute as @a[scores={tobi_defensive=1,tobi_has_armor=1}] at @s as @e[type=arrow,distance=..5] at @s run playsound minecraft:entity.enderman.teleport player @a ~ ~ ~ 0.5 1.5
execute as @a[scores={tobi_defensive=1,tobi_has_armor=1}] at @s run kill @e[type=arrow,distance=..5]

execute as @a[scores={tobi_defensive=1,tobi_has_armor=1}] at @s as @e[type=spectral_arrow,distance=..5] at @s run particle minecraft:smoke ~ ~ ~ 0.2 0.2 0.2 0.05 10 force
execute as @a[scores={tobi_defensive=1,tobi_has_armor=1}] at @s as @e[type=spectral_arrow,distance=..5] at @s run playsound minecraft:entity.enderman.teleport player @a ~ ~ ~ 0.5 1.5
execute as @a[scores={tobi_defensive=1,tobi_has_armor=1}] at @s run kill @e[type=spectral_arrow,distance=..5]

execute as @a[scores={tobi_defensive=1,tobi_has_armor=1}] at @s as @e[type=trident,distance=..5] at @s run particle minecraft:smoke ~ ~ ~ 0.2 0.2 0.2 0.05 10 force
execute as @a[scores={tobi_defensive=1,tobi_has_armor=1}] at @s as @e[type=trident,distance=..5] at @s run playsound minecraft:entity.enderman.teleport player @a ~ ~ ~ 0.5 1.5
execute as @a[scores={tobi_defensive=1,tobi_has_armor=1}] at @s run kill @e[type=trident,distance=..5]

execute as @a[scores={tobi_defensive=1,tobi_has_armor=1}] at @s as @e[type=fireball,distance=..5] at @s run particle minecraft:smoke ~ ~ ~ 0.2 0.2 0.2 0.05 10 force
execute as @a[scores={tobi_defensive=1,tobi_has_armor=1}] at @s as @e[type=fireball,distance=..5] at @s run playsound minecraft:entity.enderman.teleport player @a ~ ~ ~ 0.5 1.5
execute as @a[scores={tobi_defensive=1,tobi_has_armor=1}] at @s run kill @e[type=fireball,distance=..5]

execute as @a[scores={tobi_defensive=1,tobi_has_armor=1}] at @s as @e[type=small_fireball,distance=..5] at @s run particle minecraft:smoke ~ ~ ~ 0.2 0.2 0.2 0.05 10 force
execute as @a[scores={tobi_defensive=1,tobi_has_armor=1}] at @s as @e[type=small_fireball,distance=..5] at @s run playsound minecraft:entity.enderman.teleport player @a ~ ~ ~ 0.5 1.5
execute as @a[scores={tobi_defensive=1,tobi_has_armor=1}] at @s run kill @e[type=small_fireball,distance=..5]

execute as @a[scores={tobi_defensive=1,tobi_has_armor=1}] at @s as @e[type=snowball,distance=..5] at @s run particle minecraft:smoke ~ ~ ~ 0.2 0.2 0.2 0.05 10 force
execute as @a[scores={tobi_defensive=1,tobi_has_armor=1}] at @s as @e[type=snowball,distance=..5] at @s run playsound minecraft:entity.enderman.teleport player @a ~ ~ ~ 0.5 1.5
execute as @a[scores={tobi_defensive=1,tobi_has_armor=1}] at @s run kill @e[type=snowball,distance=..5]

execute as @a[scores={tobi_defensive=1,tobi_has_armor=1}] at @s as @e[type=egg,distance=..5] at @s run particle minecraft:smoke ~ ~ ~ 0.2 0.2 0.2 0.05 10 force
execute as @a[scores={tobi_defensive=1,tobi_has_armor=1}] at @s as @e[type=egg,distance=..5] at @s run playsound minecraft:entity.enderman.teleport player @a ~ ~ ~ 0.5 1.5
execute as @a[scores={tobi_defensive=1,tobi_has_armor=1}] at @s run kill @e[type=egg,distance=..5]

execute as @a[scores={tobi_defensive=1,tobi_has_armor=1}] at @s as @e[type=dragon_fireball,distance=..5] at @s run particle minecraft:smoke ~ ~ ~ 0.2 0.2 0.2 0.05 10 force
execute as @a[scores={tobi_defensive=1,tobi_has_armor=1}] at @s as @e[type=dragon_fireball,distance=..5] at @s run playsound minecraft:entity.enderman.teleport player @a ~ ~ ~ 0.5 1.5
execute as @a[scores={tobi_defensive=1,tobi_has_armor=1}] at @s run kill @e[type=dragon_fireball,distance=..5]

execute as @a[scores={tobi_defensive=1,tobi_has_armor=1}] at @s as @e[type=wither_skull,distance=..5] at @s run particle minecraft:smoke ~ ~ ~ 0.2 0.2 0.2 0.05 10 force
execute as @a[scores={tobi_defensive=1,tobi_has_armor=1}] at @s as @e[type=wither_skull,distance=..5] at @s run playsound minecraft:entity.enderman.teleport player @a ~ ~ ~ 0.5 1.5
execute as @a[scores={tobi_defensive=1,tobi_has_armor=1}] at @s run kill @e[type=wither_skull,distance=..5]

# ============================================
# GRANT CONTINUOUS RESISTANCE (invulnerability)
# ============================================
execute as @a[scores={tobi_defensive=1,tobi_has_armor=1}] run effect give @s minecraft:resistance 1 255 true

# ============================================
# APPLY WEAKNESS to all nearby entities
# ============================================
execute as @a[scores={tobi_defensive=1,tobi_has_armor=1}] at @s run effect give @e[type=!player,type=!item,type=!experience_orb,distance=..20] minecraft:weakness 15 255 true

# ============================================
# VISUAL FEEDBACK - Dragon breath particles
# ============================================
execute as @a[scores={tobi_defensive=1,tobi_has_armor=1}] at @s run particle minecraft:smoke ~ ~1 ~ 0.3 0.5 0.3 0.01 2 force
